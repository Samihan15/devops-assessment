name: Docker Build & Push

on:
  workflow_run:
    workflows: ["Build Node App"]
    types: [completed]

jobs:
  docker:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/download-artifact@v4
        with:
          name: node-dist
          path: dist/
      - uses: docker/login-action@v3
        with:
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}
      - run: |
          docker build -t myapp:${{ github.sha }} .
          docker push myapp:${{ github.sha }}
